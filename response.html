<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
</head>

<body>
  <select name="" id="subjectDropdown"></select>
  <script>
    parsedResponse = [
      {
        department: "dit",
        year: "III",
        semester: "5",
        subject_code: "CS8151",
        subject_name: "Python Programming Super",
        subCode_dept_sem: "cs8151_dit_5",
        required_timestamp: "2020-05-22 12:00:00",
        datetime: "2020-05-26 14:08:09",
        displaydate: "26.05.2020 - Tuesday",
        source: "super",
      },
      {
        department: "dit",
        year: "III",
        semester: "5",
        subject_code: "IT8551b",
        subject_name: "Web Technology Laboratory B",
        subCode_dept_sem: "it8551b_dit_5",
        required_timestamp: "2020-05-22 12:00:00",
        datetime: "2020-05-26 14:08:09",
        displaydate: "26.05.2020 - Tuesday",
        source: "regular",
      },
    ];

    var finalResponse = [];
    var workingResponse = [];

    console.log(parsedResponse);
    if (parsedResponse === "invalid-auth-or-access") {
      // handle auth error
      localStorage.clear();
      window.location.reload();
    } else if (parsedResponse === "no-class") {
      document.getElementById("subjectDropdown").innerHTML = "";
      //document.getElementById("subjectDropdown").classList.add("disabledDivOpacity");
      //document.getElementById("takeAttendanceError").style.display = "block";
      //document.getElementById("odFormButton").setAttribute("disabled", "disabled");
    } else {
      // success
      document.getElementById("subjectDropdown").innerHTML = "";

      workingResponse = parsedResponse;
      var j = parsedResponse.length;

      if (j > 1) {
        for (i = 0; i < j; i++) {
          //getting 1st element from parsed response and pushing it to array
          finalResponse.push(workingResponse[i]);

          // checking if two elements are the same
          if (
            workingResponse[i + 1].subCode_dept_sem ===
            finalResponse[i].subCode_dept_sem
          ) {
            // checking the source
            if (finalResponse[i].source === "regular") {
              const index = finalResponse.indexOf(finalResponse[i]);
              if (index > -1) {
                finalResponse.splice(index, 1);
              }
              finalResponse.push(workingResponse[i + 1]);
            }
          }
          else {
            var option = document.createElement("option");
            var optionTextNode = document.createTextNode(
              parsedResponse[i].subject_name
            );
            option.setAttribute("value", parsedResponse[i].subCode_dept_sem);
            option.appendChild(optionTextNode);
            document.getElementById("subjectDropdown").appendChild(option);
          }

          if (i == j) {
            var option = document.createElement("option");
            var optionTextNode = document.createTextNode(
              parsedResponse[i + 1].subject_name
            );
            option.setAttribute(
              "value",
              parsedResponse[i + 1].subCode_dept_sem
            );
            option.appendChild(optionTextNode);
            document.getElementById("subjectDropdown").appendChild(option);
          }
        }
        document
          .getElementById("subjectDropdown")
          .classList.remove("disabledDivOpacity");
        //document.getElementById("takeAttendanceError").style.display = "none";
        //document.getElementById("odFormButton").removeAttribute("disabled", "disabled");
      } else {
        var option = document.createElement("option");
        var optionTextNode = document.createTextNode(
          parsedResponse[0].subject_name
        );
        option.setAttribute("value", parsedResponse[0].subCode_dept_sem);
        option.appendChild(optionTextNode);
        document.getElementById("subjectDropdown").appendChild(option);

        //document.getElementById("subjectDropdown").classList.remove("disabledDivOpacity");
        //document.getElementById("takeAttendanceError").style.display = "none";
        //document.getElementById("odFormButton").removeAttribute("disabled", "disabled");
      }
    }
  </script>
</body>

</html>